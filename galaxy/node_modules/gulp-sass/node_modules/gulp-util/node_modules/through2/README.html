<!DOCTYPE html><html><head><link rel="stylesheet" href="galaxy/galaxy.css"><link rel="stylesheet" href="//cloud.typography.com/6579472/723444/css/fonts.css"><script src="jquery.js"></script><script src="docs.js"></script><script src="https://galaxyui.com/js/prism.js"></script></head><body ondragstart="return false"><header><ul><li><a href="//www.bnotions.com"><img src="media/logo.svg" width="130"></a></li><li><a href="http://www.bnotions.com/insights/">Stories</a></li><li><a href="https://medium.com/bnotions">Screen Theory</a></li></ul></header><h1>through2</h1>
<!--

soon ...

[![Build Status](https://secure.travis-ci.org/rvagg/through2.png)](http://travis-ci.org/rvagg/through2)

[![Build Status](https://saucelabs.com/browser-matrix/through2-sauce.svg)](https://travis-ci.org/rvagg/through2)

-->

<p><a href="https://nodei.co/npm/through2/"><img src="https://nodei.co/npm/through2.png?downloads&amp;downloadRank" alt="NPM"></a></p>
<!--
not happy with these, we need to peg to readable-stream@1.0.x so it'll always report out-of-date

[![david-dm](https://david-dm.org/rvagg/through2.png)](https://david-dm.org/rvagg/through2/)
[![david-dm](https://david-dm.org/rvagg/through2/dev-status.png)](https://david-dm.org/rvagg/through2#info=devDependencies/)
-->

<p><strong>A tiny wrapper around Node streams.Transform (Streams2) to avoid explicit subclassing noise</strong></p>
<p>Inspired by <a href="https://github.com/dominictarr">Dominic Tarr</a>&#39;s <a href="https://github.com/dominictarr/through">through</a> in that it&#39;s so much easier to make a stream out of a function than it is to set up the prototype chain properly: <code>through(function (chunk) { ... })</code>.</p>
<p>Note: A <strong>Streams3</strong> version of through2 is available in npm with the tag <code>&quot;1.0&quot;</code> rather than <code>&quot;latest&quot;</code> so an <code>npm install through2</code> will get you the current Streams2 version (version number is 0.x.x). To use a Streams3 version use <code>npm install through2@1</code> to fetch the latest version 1.x.x. More information about Streams2 vs Streams3 and recommendations see the article <strong><a href="http://r.va.gg/2014/06/why-i-dont-use-nodes-core-stream-module.html">Why I don&#39;t use Node&#39;s core &#39;stream&#39; module</a></strong>.</p>
<pre><code class="language-js">fs.createReadStream(&#39;ex.txt&#39;)
  .pipe(through2(function (chunk, enc, callback) {
    for (var i = 0; i &lt; chunk.length; i++)
      if (chunk[i] == 97)
        chunk[i] = 122 // swap &#39;a&#39; for &#39;z&#39;

    this.push(chunk)

    callback()
   }))
  .pipe(fs.createWriteStream(&#39;out.txt&#39;))</code></pre>
<p>Or object streams:</p>
<pre><code class="language-js">var all = []

fs.createReadStream(&#39;data.csv&#39;)
  .pipe(csv2())
  .pipe(through2.obj(function (chunk, enc, callback) {
    var data = {
        name    : chunk[0]
      , address : chunk[3]
      , phone   : chunk[10]
    }
    this.push(data)

    callback()
  }))
  .on(&#39;data&#39;, function (data) {
    all.push(data)
  })
  .on(&#39;end&#39;, function () {
    doSomethingSpecial(all)
  })</code></pre>
<p>Note that <code>through2.obj(fn)</code> is a convenience wrapper around <code>through2({ objectMode: true }, fn)</code>.</p>
<h2>API</h2>
<p><b><code>through2([ options, ] [ transformFunction ] [, flushFunction ])</code></b></p>
<p>Consult the <strong><a href="http://nodejs.org/docs/latest/api/stream.html#stream_class_stream_transform">stream.Transform</a></strong> documentation for the exact rules of the <code>transformFunction</code> (i.e. <code>this._transform</code>) and the optional <code>flushFunction</code> (i.e. <code>this._flush</code>).</p>
<h3>options</h3>
<p>The options argument is optional and is passed straight through to <code>stream.Transform</code>. So you can use <code>objectMode:true</code> if you are processing non-binary streams (or just use <code>through2.obj()</code>).</p>
<p>The <code>options</code> argument is first, unlike standard convention, because if I&#39;m passing in an anonymous function then I&#39;d prefer for the options argument to not get lost at the end of the call:</p>
<pre><code class="language-js">fs.createReadStream(&#39;/tmp/important.dat&#39;)
  .pipe(through2({ objectMode: true, allowHalfOpen: false },
    function (chunk, enc, cb) {
      cb(null, &#39;wut?&#39;) // note we can use the second argument on the callback
                       // to provide data as an alternative to this.push(&#39;wut?&#39;)
    }
  )
  .pipe(fs.createWriteStream(&#39;/tmp/wut.txt&#39;))</code></pre>
<h3>transformFunction</h3>
<p>The <code>transformFunction</code> must have the following signature: <code>function (chunk, encoding, callback) {}</code>. A minimal implementation should call the <code>callback</code> function to indicate that the transformation is done, even if that transformation means discarding the chunk.</p>
<p>To queue a new chunk, call <code>this.push(chunk)</code>&mdash;this can be called as many times as required before the <code>callback()</code> if you have multiple pieces to send on.</p>
<p>Alternatively, you may use <code>callback(err, chunk)</code> as shorthand for emitting a single chunk or an error.</p>
<p>If you <strong>do not provide a <code>transformFunction</code></strong> then you will get a simple pass-through stream.</p>
<h3>flushFunction</h3>
<p>The optional <code>flushFunction</code> is provided as the last argument (2nd or 3rd, depending on whether you&#39;ve supplied options) is called just prior to the stream ending. Can be used to finish up any processing that may be in progress.</p>
<pre><code class="language-js">fs.createReadStream(&#39;/tmp/important.dat&#39;)
  .pipe(through2(
    function (chunk, enc, cb) { cb(null, chunk) }, // transform is a noop
    function (cb) { // flush function
      this.push(&#39;tacking on an extra buffer to the end&#39;);
      cb();
    }
  ))
  .pipe(fs.createWriteStream(&#39;/tmp/wut.txt&#39;));</code></pre>
<p><b><code>through2.ctor([ options, ] transformFunction[, flushFunction ])</code></b></p>
<p>Instead of returning a <code>stream.Transform</code> instance, <code>through2.ctor()</code> returns a <strong>constructor</strong> for a custom Transform. This is useful when you want to use the same transform logic in multiple instances.</p>
<pre><code class="language-js">var FToC = through2.ctor({objectMode: true}, function (record, encoding, callback) {
  if (record.temp != null &amp;&amp; record.unit = &quot;F&quot;) {
    record.temp = ( ( record.temp - 32 ) * 5 ) / 9
    record.unit = &quot;C&quot;
  }
  this.push(record)
  callback()
})

// Create instances of FToC like so:
var converter = new FToC()
// Or:
var converter = FToC()
// Or specify/override options when you instantiate, if you prefer:
var converter = FToC({objectMode: true})</code></pre>
<h2>See Also</h2>
<ul>
<li><a href="https://github.com/brycebaril/through2-map">through2-map</a> - Array.prototype.map analog for streams.</li>
<li><a href="https://github.com/brycebaril/through2-filter">through2-filter</a> - Array.prototype.filter analog for streams.</li>
<li><a href="https://github.com/brycebaril/through2-reduce">through2-reduce</a> - Array.prototype.reduce analog for streams.</li>
<li><a href="https://github.com/brycebaril/through2-spy">through2-spy</a> - Wrapper for simple stream.PassThrough spies.</li>
</ul>
<h2>License</h2>
<p><strong>through2</strong> is Copyright (c) 2013 Rod Vagg <a href="https://twitter.com/rvagg">@rvagg</a> and licenced under the MIT licence. All rights not explicitly granted in the MIT license are reserved. See the included LICENSE file for more details.</p>
<footer g="md-margin-t"><ul g="md-container lg-padding-tb centered"><li><a href="https://twitter.com/BNOTIONS" class="twitter-follow-button" data-show-count="false">Follow @BNOTIONS</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></li></ul></footer></body></html>